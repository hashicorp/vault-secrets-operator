# Copyright (c) HashiCorp, Inc.
# SPDX-License-Identifier: BUSL-1.1

apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultDynamicSecret
metadata:
  labels:
    app.kubernetes.io/name: vaultdynamicsecret
    app.kubernetes.io/instance: vaultdynamicsecret-sample
    app.kubernetes.io/part-of: vault-secrets-operator
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/created-by: vault-secrets-operator
  name: vaultdynamicsecret-sample
spec:
  # Your existing VaultAuth (e.g., Kubernetes service account auth)
  vaultAuthRef: vaultauth-sample

  # Mount path where the database engine is enabled (e.g., 'database', 'db-prod', etc.)
  mount: database

  # Full path to your *existing* role: <engine-type>/creds/<role-name>
  # Common examples:
  #   postgresql/creds/my-app-role
  #   mysql/creds/app-readonly
  #   mongodb/creds/web-app
  path: creds/my-role # CHANGE THIS

  # How often VSO should renew (recommend: 60â€“80% of role's default_ttl)
  refreshAfter: 7m

  # Where to sync the credentials in Kubernetes
  destination:
    name: db-creds-dynamic # K8s Secret name your app will use
    create: true # VSO creates it if missing
    # type: Opaque              # default

  syncConfig:
    # enable event watcher to update secrets on event notification
    # so that updates are applied immediately
    instantUpdates: true
