# Copyright (c) HashiCorp, Inc.
# SPDX-License-Identifier: BUSL-1.1

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: csisecrets.secrets.hashicorp.com
spec:
  group: secrets.hashicorp.com
  names:
    kind: CSISecrets
    listKind: CSISecretsList
    plural: csisecrets
    singular: csisecrets
  scope: Namespaced
  versions:
  - name: v1beta1
    schema:
      openAPIV3Schema:
        description: CSISecrets is the Schema for the csisecrets API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              CSISecretsSpec defines the desired state of CSISecrets. It contains the
              configuration for the CSI driver to populate the secret data.
            properties:
              accessControl:
                description: AccessControl provides configuration for controlling
                  access to the secret.
                properties:
                  matchPolicy:
                    default: all
                    description: |-
                      MatchPolicy is the policy to use when matching the access control rules. If
                      set to "any", only one of the rules should match. If set to "all", all the
                      rules should match.
                    enum:
                    - any
                    - all
                    type: string
                  namespacePatterns:
                    description: NamespacePatterns is a list of namespace name regex
                      patterns that are allowed access.
                    items:
                      type: string
                    type: array
                  podLabels:
                    additionalProperties:
                      type: string
                    description: PodLabels is a map of pod label key-value pairs that
                      should be allowed access.
                    type: object
                  podNamePatterns:
                    description: PodNamePatterns is a list of pod name regex patterns
                      that should be allowed access.
                    items:
                      type: string
                    type: array
                  serviceAccountPattern:
                    description: |-
                      ServiceAccountPattern is the name of the service account that should be used to
                      access the secret. It can be specified as a regex pattern.
                      A valid service account is always required.
                    type: string
                required:
                - serviceAccountPattern
                type: object
              namespace:
                description: Namespace is the Vault namespace where the secret is
                  located.
                type: string
              secrets:
                description: Secrets that will be synced with the CSI driver.
                properties:
                  transformation:
                    description: |-
                      Transformation provides configuration for transforming the secret data before
                      it is stored in the CSI volume.
                    properties:
                      excludeRaw:
                        description: |-
                          ExcludeRaw data from the destination Secret. Exclusion policy can be set
                          globally by including 'exclude-raw` in the '--global-transformation-options'
                          command line flag. If set, the command line flag always takes precedence over
                          this configuration.
                        type: boolean
                      excludes:
                        description: |-
                          Excludes contains regex patterns used to filter top-level source secret data
                          fields for exclusion from the final K8s Secret data. These pattern filters are
                          never applied to templated fields as defined in Templates. They are always
                          applied before any inclusion patterns. To exclude all source secret data
                          fields, you can configure the single pattern ".*".
                        items:
                          type: string
                        type: array
                      includes:
                        description: |-
                          Includes contains regex patterns used to filter top-level source secret data
                          fields for inclusion in the final K8s Secret data. These pattern filters are
                          never applied to templated fields as defined in Templates. They are always
                          applied last.
                        items:
                          type: string
                        type: array
                      templates:
                        additionalProperties:
                          description: Template provides templating configuration.
                          properties:
                            name:
                              description: Name of the Template
                              type: string
                            text:
                              description: |-
                                Text contains the Go text template format. The template
                                references attributes from the data structure of the source secret.
                                Refer to https://pkg.go.dev/text/template for more information.
                              type: string
                          required:
                          - text
                          type: object
                        description: |-
                          Templates maps a template name to its Template. Templates are always included
                          in the rendered K8s Secret, and take precedence over templates defined in a
                          SecretTransformation.
                        type: object
                      transformationRefs:
                        description: |-
                          TransformationRefs contain references to template configuration from
                          SecretTransformation.
                        items:
                          description: |-
                            TransformationRef contains the configuration for accessing templates from an
                            SecretTransformation resource. TransformationRefs can be shared across all
                            syncable secret custom resources.
                          properties:
                            ignoreExcludes:
                              description: |-
                                IgnoreExcludes controls whether to use the SecretTransformation's Excludes
                                data key filters.
                              type: boolean
                            ignoreIncludes:
                              description: |-
                                IgnoreIncludes controls whether to use the SecretTransformation's Includes
                                data key filters.
                              type: boolean
                            name:
                              description: Name of the SecretTransformation resource.
                              type: string
                            namespace:
                              description: Namespace of the SecretTransformation resource.
                              type: string
                            templateRefs:
                              description: |-
                                TemplateRefs map to a Template found in this TransformationRef. If empty, then
                                all templates from the SecretTransformation will be rendered to the K8s Secret.
                              items:
                                description: |-
                                  TemplateRef points to templating text that is stored in a
                                  SecretTransformation custom resource.
                                properties:
                                  keyOverride:
                                    description: |-
                                      KeyOverride to the rendered template in the Destination secret. If Key is
                                      empty, then the Key from reference spec will be used. Set this to override the
                                      Key set from the reference spec.
                                    type: string
                                  name:
                                    description: |-
                                      Name of the Template in SecretTransformationSpec.Templates.
                                      the rendered secret data.
                                    type: string
                                required:
                                - name
                                type: object
                              type: array
                          required:
                          - name
                          type: object
                        type: array
                    type: object
                  vaultAppRoleSecretIDs:
                    description: VaultAppRoleSecretIDs is a list of AppRole secret
                      IDs to be used to populate the secret.
                    items:
                      description: VaultAppRoleSecretID defines the AppRole secret
                        ID to be used to populate the secret.
                      properties:
                        cidrList:
                          description: CIDRList is the list of CIDR blocks that access
                            the secret ID.
                          items:
                            type: string
                          type: array
                        metadata:
                          additionalProperties:
                            type: string
                          description: |-
                            Metadata is the metadata to be associated with the secret ID. It is set on
                            the token generated by the secret ID.
                          type: object
                        mount:
                          description: Mount path to the AppRole auth engine.
                          type: string
                        numUses:
                          description: NumUses is the number of times the secret ID
                            can be used.
                          type: integer
                        role:
                          description: Role is the name of the AppRole.
                          type: string
                        syncRoleID:
                          description: |-
                            SyncRoleID is the flag to fetch the role ID from the AppRole auth engine.
                            Requires that the provisioning VaultAuth has the necessary permissions to fetch the role ID.
                          type: boolean
                        tokenBoundCIDRs:
                          description: |-
                            TokenBoundCIDRs is the list of CIDR blocks that can be used to authenticate
                            using tokens generated by this secret ID.
                          items:
                            type: string
                          type: array
                        transformation:
                          description: |-
                            Transformation provides configuration for transforming the secret data before
                            it is stored in the CSI volume.
                          properties:
                            excludeRaw:
                              description: |-
                                ExcludeRaw data from the destination Secret. Exclusion policy can be set
                                globally by including 'exclude-raw` in the '--global-transformation-options'
                                command line flag. If set, the command line flag always takes precedence over
                                this configuration.
                              type: boolean
                            excludes:
                              description: |-
                                Excludes contains regex patterns used to filter top-level source secret data
                                fields for exclusion from the final K8s Secret data. These pattern filters are
                                never applied to templated fields as defined in Templates. They are always
                                applied before any inclusion patterns. To exclude all source secret data
                                fields, you can configure the single pattern ".*".
                              items:
                                type: string
                              type: array
                            includes:
                              description: |-
                                Includes contains regex patterns used to filter top-level source secret data
                                fields for inclusion in the final K8s Secret data. These pattern filters are
                                never applied to templated fields as defined in Templates. They are always
                                applied last.
                              items:
                                type: string
                              type: array
                            templates:
                              additionalProperties:
                                description: Template provides templating configuration.
                                properties:
                                  name:
                                    description: Name of the Template
                                    type: string
                                  text:
                                    description: |-
                                      Text contains the Go text template format. The template
                                      references attributes from the data structure of the source secret.
                                      Refer to https://pkg.go.dev/text/template for more information.
                                    type: string
                                required:
                                - text
                                type: object
                              description: |-
                                Templates maps a template name to its Template. Templates are always included
                                in the rendered K8s Secret, and take precedence over templates defined in a
                                SecretTransformation.
                              type: object
                            transformationRefs:
                              description: |-
                                TransformationRefs contain references to template configuration from
                                SecretTransformation.
                              items:
                                description: |-
                                  TransformationRef contains the configuration for accessing templates from an
                                  SecretTransformation resource. TransformationRefs can be shared across all
                                  syncable secret custom resources.
                                properties:
                                  ignoreExcludes:
                                    description: |-
                                      IgnoreExcludes controls whether to use the SecretTransformation's Excludes
                                      data key filters.
                                    type: boolean
                                  ignoreIncludes:
                                    description: |-
                                      IgnoreIncludes controls whether to use the SecretTransformation's Includes
                                      data key filters.
                                    type: boolean
                                  name:
                                    description: Name of the SecretTransformation
                                      resource.
                                    type: string
                                  namespace:
                                    description: Namespace of the SecretTransformation
                                      resource.
                                    type: string
                                  templateRefs:
                                    description: |-
                                      TemplateRefs map to a Template found in this TransformationRef. If empty, then
                                      all templates from the SecretTransformation will be rendered to the K8s Secret.
                                    items:
                                      description: |-
                                        TemplateRef points to templating text that is stored in a
                                        SecretTransformation custom resource.
                                      properties:
                                        keyOverride:
                                          description: |-
                                            KeyOverride to the rendered template in the Destination secret. If Key is
                                            empty, then the Key from reference spec will be used. Set this to override the
                                            Key set from the reference spec.
                                          type: string
                                        name:
                                          description: |-
                                            Name of the Template in SecretTransformationSpec.Templates.
                                            the rendered secret data.
                                          type: string
                                      required:
                                      - name
                                      type: object
                                    type: array
                                required:
                                - name
                                type: object
                              type: array
                          type: object
                        ttl:
                          description: TTL is the TTL for the secret ID, after which
                            it becomes invalid.
                          pattern: ^([0-9]+(\.[0-9]+)?(s|m|h))$
                          type: string
                        wrapTTL:
                          description: WrapTTL is the TTL for the wrapped secret ID.
                          pattern: ^([0-9]+(\.[0-9]+)?(s|m|h))$
                          type: string
                      required:
                      - mount
                      - role
                      type: object
                    type: array
                  vaultStaticSecrets:
                    description: VaultStaticSecrets is a list of static secrets to
                      be synced by the CSI driver.
                    items:
                      properties:
                        mount:
                          description: Mount for the secret in Vault
                          type: string
                        path:
                          description: |-
                            Path of the secret in Vault, corresponds to the `path` parameter for:
                            kv-v1: https://developer.hashicorp.com/vault/api-docs/secret/kv/kv-v1#read-secret
                            kv-v2: https://developer.hashicorp.com/vault/api-docs/secret/kv/kv-v2#read-secret-version
                          type: string
                        transformation:
                          description: |-
                            Transformation provides configuration for transforming the secret data before
                            it is stored in the CSI volume.
                          properties:
                            excludeRaw:
                              description: |-
                                ExcludeRaw data from the destination Secret. Exclusion policy can be set
                                globally by including 'exclude-raw` in the '--global-transformation-options'
                                command line flag. If set, the command line flag always takes precedence over
                                this configuration.
                              type: boolean
                            excludes:
                              description: |-
                                Excludes contains regex patterns used to filter top-level source secret data
                                fields for exclusion from the final K8s Secret data. These pattern filters are
                                never applied to templated fields as defined in Templates. They are always
                                applied before any inclusion patterns. To exclude all source secret data
                                fields, you can configure the single pattern ".*".
                              items:
                                type: string
                              type: array
                            includes:
                              description: |-
                                Includes contains regex patterns used to filter top-level source secret data
                                fields for inclusion in the final K8s Secret data. These pattern filters are
                                never applied to templated fields as defined in Templates. They are always
                                applied last.
                              items:
                                type: string
                              type: array
                            templates:
                              additionalProperties:
                                description: Template provides templating configuration.
                                properties:
                                  name:
                                    description: Name of the Template
                                    type: string
                                  text:
                                    description: |-
                                      Text contains the Go text template format. The template
                                      references attributes from the data structure of the source secret.
                                      Refer to https://pkg.go.dev/text/template for more information.
                                    type: string
                                required:
                                - text
                                type: object
                              description: |-
                                Templates maps a template name to its Template. Templates are always included
                                in the rendered K8s Secret, and take precedence over templates defined in a
                                SecretTransformation.
                              type: object
                            transformationRefs:
                              description: |-
                                TransformationRefs contain references to template configuration from
                                SecretTransformation.
                              items:
                                description: |-
                                  TransformationRef contains the configuration for accessing templates from an
                                  SecretTransformation resource. TransformationRefs can be shared across all
                                  syncable secret custom resources.
                                properties:
                                  ignoreExcludes:
                                    description: |-
                                      IgnoreExcludes controls whether to use the SecretTransformation's Excludes
                                      data key filters.
                                    type: boolean
                                  ignoreIncludes:
                                    description: |-
                                      IgnoreIncludes controls whether to use the SecretTransformation's Includes
                                      data key filters.
                                    type: boolean
                                  name:
                                    description: Name of the SecretTransformation
                                      resource.
                                    type: string
                                  namespace:
                                    description: Namespace of the SecretTransformation
                                      resource.
                                    type: string
                                  templateRefs:
                                    description: |-
                                      TemplateRefs map to a Template found in this TransformationRef. If empty, then
                                      all templates from the SecretTransformation will be rendered to the K8s Secret.
                                    items:
                                      description: |-
                                        TemplateRef points to templating text that is stored in a
                                        SecretTransformation custom resource.
                                      properties:
                                        keyOverride:
                                          description: |-
                                            KeyOverride to the rendered template in the Destination secret. If Key is
                                            empty, then the Key from reference spec will be used. Set this to override the
                                            Key set from the reference spec.
                                          type: string
                                        name:
                                          description: |-
                                            Name of the Template in SecretTransformationSpec.Templates.
                                            the rendered secret data.
                                          type: string
                                      required:
                                      - name
                                      type: object
                                    type: array
                                required:
                                - name
                                type: object
                              type: array
                          type: object
                        type:
                          description: Type of the Vault static secret
                          enum:
                          - kv-v1
                          - kv-v2
                          type: string
                        version:
                          description: |-
                            Version of the secret to fetch. Only valid for type kv-v2. Corresponds to version query parameter:
                            https://developer.hashicorp.com/vault/api-docs/secret/kv/kv-v2#version
                          minimum: 0
                          type: integer
                      required:
                      - mount
                      - path
                      - type
                      type: object
                    type: array
                type: object
              syncConfig:
                description: SyncConfig provides configuration for syncing the secret
                  data with the CSI driver.
                properties:
                  containerState:
                    description: |-
                      ContainerState is the state of the container that the CSI driver always sync
                      on. This configuration is useful to sync when the last state of the container
                      is in the terminated state and the restart count is greater than 0.
                    properties:
                      imagePattern:
                        description: ImagePattern of the container. Can be expressed
                          as a regular expression.
                        type: string
                      namePattern:
                        description: NamePattern of the container. Can be expressed
                          as a regular expression.
                        type: string
                    type: object
                required:
                - containerState
                type: object
              vaultAuthRef:
                description: VaultAuthRef is the reference to the VaultAuth resource.
                properties:
                  name:
                    description: Name of the VaultAuth resource.
                    type: string
                  namespace:
                    description: Namespace of the VaultAuth resource.
                    type: string
                  trustNamespace:
                    description: |-
                      TrustNamespace of the referring VaultAuth resource. This means that any Vault
                      credentials will be provided by resources in the same namespace as the
                      VaultAuth resource. Otherwise, the credentials will be provided by the secret
                      resource's namespace.
                    type: boolean
                required:
                - name
                type: object
            required:
            - accessControl
            - secrets
            type: object
          status:
            description: CSISecretsStatus defines the observed state of CSISecrets
            properties:
              conditions:
                description: |-
                  Conditions hold information that can be used by other apps to determine the
                  health of the resource instance.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
